exports.id=840,exports.ids=[840],exports.modules={7978:(e,t,r)=>{let a={"3499287959de4cf7cd151d3acac55d85ff9e10f8":()=>Promise.resolve().then(r.bind(r,4819)).then(e=>e.addUserEmailToProduct),"59bacc1537d577b9e0aa6140dd74f746ece4b1d1":()=>Promise.resolve().then(r.bind(r,4819)).then(e=>e.scrapeAndStoreProduct),"8a781e892efe4fec537be68010a386e353158fac":()=>Promise.resolve().then(r.bind(r,4819)).then(e=>e.getSimilarProducts),ea107abdfe2580464aef63750ca995ad0293a55c:()=>Promise.resolve().then(r.bind(r,4819)).then(e=>e.getProductById),f1620e392c3a74b34ce3362dcd57552b4e04ffa8:()=>Promise.resolve().then(r.bind(r,4819)).then(e=>e.getAllProducts),"9e927f4e1bfa1d208662dbf8cd193e0dc3379b18":()=>Promise.resolve().then(r.bind(r,1958)).then(e=>e.generateEmailBody),f4f8047e7c8ca2955d00dd826aa0d1da14a1a83c:()=>Promise.resolve().then(r.bind(r,1958)).then(e=>e.sendEmail),a0f90306739114daeb10c76912722478d8c6c533:()=>Promise.resolve().then(r.bind(r,751)).then(e=>e.scrapeAmazonProduct)};async function c(e,...t){return(await a[e]()).apply(null,t)}e.exports={"3499287959de4cf7cd151d3acac55d85ff9e10f8":c.bind(null,"3499287959de4cf7cd151d3acac55d85ff9e10f8"),"59bacc1537d577b9e0aa6140dd74f746ece4b1d1":c.bind(null,"59bacc1537d577b9e0aa6140dd74f746ece4b1d1"),"8a781e892efe4fec537be68010a386e353158fac":c.bind(null,"8a781e892efe4fec537be68010a386e353158fac"),ea107abdfe2580464aef63750ca995ad0293a55c:c.bind(null,"ea107abdfe2580464aef63750ca995ad0293a55c"),f1620e392c3a74b34ce3362dcd57552b4e04ffa8:c.bind(null,"f1620e392c3a74b34ce3362dcd57552b4e04ffa8"),"9e927f4e1bfa1d208662dbf8cd193e0dc3379b18":c.bind(null,"9e927f4e1bfa1d208662dbf8cd193e0dc3379b18"),f4f8047e7c8ca2955d00dd826aa0d1da14a1a83c:c.bind(null,"f4f8047e7c8ca2955d00dd826aa0d1da14a1a83c"),a0f90306739114daeb10c76912722478d8c6c533:c.bind(null,"a0f90306739114daeb10c76912722478d8c6c533")}},3797:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,2583,23)),Promise.resolve().then(r.t.bind(r,6840,23)),Promise.resolve().then(r.t.bind(r,8771,23)),Promise.resolve().then(r.t.bind(r,3225,23)),Promise.resolve().then(r.t.bind(r,9295,23)),Promise.resolve().then(r.t.bind(r,3982,23))},4452:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,1900,23)),Promise.resolve().then(r.t.bind(r,1476,23))},6228:(e,t,r)=>{"use strict";r.d(t,{x4:()=>i,yS:()=>c}),r(3664);var a=r(8371),c=(0,a.$)("3499287959de4cf7cd151d3acac55d85ff9e10f8"),i=(0,a.$)("59bacc1537d577b9e0aa6140dd74f746ece4b1d1");(0,a.$)("ea107abdfe2580464aef63750ca995ad0293a55c"),(0,a.$)("f1620e392c3a74b34ce3362dcd57552b4e04ffa8"),(0,a.$)("8a781e892efe4fec537be68010a386e353158fac")},9012:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>p,metadata:()=>f});var a=r(5036),c=r(265),i=r.n(c);r(7272);var n=r(5904),s=r.n(n),d=r(646),o=r.n(d);r(2);let l=[{src:"/assets/icons/search.svg",alt:"search"},{src:"/assets/icons/red-heart.svg",alt:"heart"},{src:"/assets/icons/user.svg",alt:"user"}],u=()=>a.jsx("header",{className:"w-full",children:(0,a.jsxs)("nav",{className:"nav",children:[(0,a.jsxs)(o(),{href:"/",className:"flex items-center gap-1",children:[a.jsx(s(),{src:"/assets/icons/logo.svg",width:27,height:27,alt:"logo"}),(0,a.jsxs)("p",{className:"nav-logo",children:["Web",a.jsx("span",{className:"text-primary",children:"Ease"})]})]}),a.jsx("div",{className:"flex items-center gap-5",children:l.map(e=>a.jsx(s(),{src:e.src,alt:e.alt,width:30,height:30,className:"object-contain"},e.alt))})]})}),f={title:"WebEase",description:"Get BEST price ever"};function p({children:e}){return a.jsx("html",{lang:"en",children:a.jsx("body",{className:i().className,children:(0,a.jsxs)("main",{className:"max-w-10xl mx-auto",children:[a.jsx(u,{}),e]})})})}},1622:(e,t,r)=>{"use strict";r.d(t,{Z:()=>d});var a=r(5036),c=r(5904),i=r.n(c),n=r(646),s=r.n(n);r(2);let d=({product:e})=>(0,a.jsxs)(s(),{href:`/products/${e._id}`,className:"product-card",children:[a.jsx("div",{className:"product-card_img-container",children:a.jsx(i(),{src:e.image,alt:e.title,width:200,height:200,className:"product-card_img"})}),(0,a.jsxs)("div",{className:"flex flex-col gap-3",children:[a.jsx("h3",{className:"product-title",children:e.title}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsxs)("p",{className:"text-black opacity-50 text-lg font-semibold",children:[a.jsx("span",{children:e?.currency}),a.jsx("span",{className:"text-[25px] text-black line-through",children:e?.originalPrice})]}),(0,a.jsxs)("p",{className:"text-black opacity-50 text-lg font-semibold",children:[a.jsx("span",{children:e?.currency}),a.jsx("span",{children:e?.currentPrice})]})]})]})]})},4819:(e,t,r)=>{"use strict";r.r(t),r.d(t,{addUserEmailToProduct:()=>m,getAllProducts:()=>f,getProductById:()=>u,getSimilarProducts:()=>p,scrapeAndStoreProduct:()=>l});var a=r(4471);r(8616);var c=r(6864),i=r(751),n=r(248),s=r(2355),d=r(5752),o=r(1958);async function l(e){if(e){console.log("scraping product",e);try{(0,n.P)();let t=await (0,i.scrapeAmazonProduct)(e);if(!t)return;let r=t,a=await s.Z.findOne({url:t.url});if(a){let e=[...a.priceHistory,{price:t.currentPrice}];r={...t,priceHistory:e,lowestPrice:(0,d.nd)(e),highestPrice:(0,d.TF)(e),averagePrice:(0,d.bd)(e)}}let o=await s.Z.findOneAndUpdate({url:t.url},r,{upsert:!0,new:!0});(0,c.revalidatePath)(`/product/${o._id}`)}catch(t){throw Error(`failed to scrape product ${e}: ${t.message}`)}finally{}}}async function u(e){try{(0,n.P)();let t=await s.Z.findOne({_id:e});if((0,c.revalidatePath)(`/product/${t._id}`),!t)return null;return t}catch(t){throw Error(`failed to get product ${e}: ${t.message}`)}finally{}}async function f(){try{return(0,n.P)(),await s.Z.find()}catch(e){console.log("error",e)}}async function p(e){try{if((0,n.P)(),!await s.Z.findById(e))return null;return await s.Z.find({id:{$ne:e}}).limit(6)}catch(e){console.log("error",e)}}async function m(e,t){try{let r=await s.Z.findById(e);if(!r)return;if(!r.users.some(e=>e.email===t)){r.users.push({email:t}),await r.save();let e=await (0,o.generateEmailBody)(r,"WELCOME");await (0,o.sendEmail)(e,[t])}}catch(e){}}(0,r(2053).h)([l,u,f,p,m]),(0,a.U)("59bacc1537d577b9e0aa6140dd74f746ece4b1d1",l),(0,a.U)("ea107abdfe2580464aef63750ca995ad0293a55c",u),(0,a.U)("f1620e392c3a74b34ce3362dcd57552b4e04ffa8",f),(0,a.U)("8a781e892efe4fec537be68010a386e353158fac",p),(0,a.U)("3499287959de4cf7cd151d3acac55d85ff9e10f8",m)},2355:(e,t,r)=>{"use strict";r.d(t,{Z:()=>n});var a=r(1185),c=r.n(a);let i=new(c()).Schema({url:{type:String,required:!0,unique:!0},title:{type:String,required:!0},currency:{type:String,required:!0},image:{type:String,required:!0},currentPrice:{type:Number,required:!0},originalPrice:{type:Number,required:!0},priceHistory:[{price:{type:Number,required:!0},date:{type:Date,required:!0,default:Date.now}}],lowestPrice:{type:Number},highestPrice:{type:Number},avgPrice:{type:Number},discountRate:{type:Number},description:{type:String},category:{type:String},reviewsCount:{type:String},isOutOfStock:{type:Boolean,default:!1},users:[{email:{type:String,required:!0}}],default:[]},{timestamps:!0}),n=c().models.Product||c().model("Product",i)},1958:(e,t,r)=>{"use strict";r.r(t),r.d(t,{generateEmailBody:()=>s,sendEmail:()=>o});var a=r(4471);r(8616);var c=r(8140),i=r(2053);let n={WELCOME:"WELCOME",CHANGE_OF_STOCK:"CHANGE_OF_STOCK",LOWEST_PRICE:"LOWEST_PRICE",THRESHOLD_MET:"THRESHOLD_MET"};async function s(e,t){let r=e.title.length>20?`${e.title.substring(0,20)}...`:e.title,a="",c="";switch(t){case n.WELCOME:a=`Welcome to Price Tracking for ${r}`,c=`
        <div>
          <h2>Welcome to WebEase ðŸš€</h2>
          <p>You are now tracking ${e.title}.</p>
          <p>Here's an example of how you'll receive updates:</p>
          <div style="border: 1px solid #ccc; padding: 10px; background-color: #f8f8f8;">
            <h3>${e.title} is back in stock!</h3>
            <p>We're excited to let you know that ${e.title} is now back in stock.</p>
            <p>Don't miss out - <a href="${e.url}" target="_blank" rel="noopener noreferrer">buy it now</a>!</p>
            <img src="https://i.ibb.co/pwFBRMC/Screenshot-2023-09-26-at-1-47-50-AM.png" alt="Product Image" style="max-width: 100%;" />
          </div>
          <p>Stay tuned for more updates on ${e.title} and other products you're tracking.</p>
        </div>
      `;break;case n.CHANGE_OF_STOCK:a=`${r} is now back in stock!`,c=`
        <div>
          <h4>Hey, ${e.title} is now restocked! Grab yours before they run out again!</h4>
          <p>See the product <a href="${e.url}" target="_blank" rel="noopener noreferrer">here</a>.</p>
        </div>
      `;break;case n.LOWEST_PRICE:a=`Lowest Price Alert for ${r}`,c=`
        <div>
          <h4>Hey, ${e.title} has reached its lowest price ever!!</h4>
          <p>Grab the product <a href="${e.url}" target="_blank" rel="noopener noreferrer">here</a> now.</p>
        </div>
      `;break;case n.THRESHOLD_MET:a=`Discount Alert for ${r}`,c=`
        <div>
          <h4>Hey, ${e.title} is now available at a discount more than 40%!</h4>
          <p>Grab it right away from <a href="${e.url}" target="_blank" rel="noopener noreferrer">here</a>.</p>
        </div>
      `;break;default:throw Error("Invalid notification type.")}return{subject:a,body:c}}let d=c.createTransport({pool:!0,service:"hotmail",port:2525,auth:{user:"dmwadile55@outlook.com",pass:process.env.EMAIL_PASSWORD},maxConnections:1}),o=async(e,t)=>{let r={from:"dmwadile55@outlook.com",to:t,html:e.body,subject:e.subject};d.sendMail(r,(e,t)=>{if(e)return console.log(e);console.log("Email sent: ",t)})};(0,i.h)([s,o]),(0,a.U)("9e927f4e1bfa1d208662dbf8cd193e0dc3379b18",s),(0,a.U)("f4f8047e7c8ca2955d00dd826aa0d1da14a1a83c",o)},751:(e,t,r)=>{"use strict";r.r(t),r.d(t,{scrapeAmazonProduct:()=>s});var a=r(4471);r(8616);var c=r(3567),i=r(7364),n=r(5752);async function s(e){if(!e)return;let t=String(process.env.BRIGHT_DATA_USERNAME),r={auth:{username:`${t}-session-${1e6*Math.random()|0}`,password:String(process.env.BRIGHT_DATA_PASSWORD)},host:"brd.superproxy.io",port:22225,rejectUnauthorized:!1};try{let t=await c.Z.get(e,r),a=i.zD(t.data),s=a("#productTitle").text().trim(),d=(0,n.EL)(a(".priceToPay span.a-price-whole"),a(".a.size.base.a-color-price"),a(".a-button-selected .a-color-base")),o=(0,n.EL)(a("#priceblock_ourprice"),a(".a-price.a-text-price span.a-offscreen"),a(".basisPrice"),a(".a-price.a-text-price span.a-offscreen"),a("#listPrice"),a("#priceblock_dealprice"),a(".a-size-base.a-color-price")),l="currently unavailable"===a("#availability span").text().trim().toLowerCase(),u=a("#imgBlkFront").attr("data-a-dynamic-image")||a("#landingImage").attr("data-a-dynamic-image")||"{}",f=Object.keys(JSON.parse(u)),p=(0,n.Eq)(a(".a-price-symbol")),m=a(".savingsPercentage").text().replace(/[-%]/g,""),b=(0,n.B0)(a),h=parseInt(a("#acrCustomerReviewText.a-size-base").text().trim(),10),g=a("#acrPopover .a-size-base").text().trim(),y={url:e,currency:p||"$",image:f[0],title:s,currentPrice:Number(d)||Number(o),originalPrice:Number(o)||Number(d),priceHistory:[],discountRate:Number(m),category:"category",reviewsCount:h,stars:Number(g)||Number(4.5),isOutOfStock:l,description:b,lowestPrice:Number(d)||Number(o),highestPrice:Number(o)||Number(d),averagePrice:(Number(d)+Number(o))/2};return a("#prodDetails.a-section").text().trim(),y}catch(e){console.log(e)}}(0,r(2053).h)([s]),(0,a.U)("a0f90306739114daeb10c76912722478d8c6c533",s)},248:(e,t,r)=>{"use strict";r.d(t,{P:()=>n});var a=r(1185),c=r.n(a);let i=!1,n=async()=>{if(c().set("strictQuery",!0),process.env.MONGO_URI||console.log("MONGO_URI not defined"),i){console.log("db already connected");return}try{await c().connect("mongodb+srv://dmwadile:dmwadile@amazonproducts.ynww3vn.mongodb.net/?retryWrites=true&w=majority&appName=AmazonProducts"),i=!0,console.log("MongoDB already connected")}catch(e){console.log("error connecting to db")}}},5752:(e,t,r)=>{"use strict";r.d(t,{B0:()=>n,EL:()=>c,Eq:()=>i,TF:()=>s,Ux:()=>l,bd:()=>o,nd:()=>d,uf:()=>u});let a={CHANGE_OF_STOCK:"CHANGE_OF_STOCK",LOWEST_PRICE:"LOWEST_PRICE",THRESHOLD_MET:"THRESHOLD_MET"};function c(...e){for(let t of e){let e=t.text().trim();if(e){let t;let r=e.replace(/[^\d.]/g,"");return r&&(t=r.match(/\d+\.\d{2}/)?.[0]),t||r}}return""}function i(e){return e.text().trim().slice(0,1)||""}function n(e){for(let t of[".a-unordered-list .a-list-item",".a-expander-content p"]){let r=e(t);if(r.length>0)return r.map((t,r)=>e(r).text().trim()).get().join("\n")}return""}function s(e){let t=e[0];for(let r=0;r<e.length;r++)e[r].price>t.price&&(t=e[r]);return t.price}function d(e){let t=e[0];for(let r=0;r<e.length;r++)e[r].price<t.price&&(t=e[r]);return t.price}function o(e){return e.reduce((e,t)=>e+t.price,0)/e.length||0}let l=(e,t)=>{let r=d(t.priceHistory);return e.currentPrice<r?a.LOWEST_PRICE:!e.isOutOfStock&&t.isOutOfStock?a.CHANGE_OF_STOCK:e.discountRate>=40?a.THRESHOLD_MET:null},u=(e=0)=>e.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:0})},7481:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>c});var a=r(337);let c=e=>[{type:"image/x-icon",sizes:"128x128",url:(0,a.fillMetadataSegment)(".",e.params,"favicon.ico")+""}]},7272:()=>{}};